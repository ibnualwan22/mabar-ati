<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cetak Kartu Barang Santri</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            background-color: #f0f2f5;
            font-family: 'Poppins', sans-serif;
        }
        
        .print-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .cards-wrapper {
            display: grid;
            gap: 3mm;
            justify-content: center;
            /* Default grid 3x5 */
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(5, auto);
        }

        .card-barang {
            border: 2px solid #2c3e50;
            border-radius: 12px;
            padding: 8mm;
            box-sizing: border-box;
            page-break-inside: avoid;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            min-height: 70mm;
        }
        
        .card-barang::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100px;
            height: 100px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            z-index: 0;
        }
        
        .card-barang::after {
            content: '';
            position: absolute;
            bottom: -30px;
            left: -30px;
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.08);
            border-radius: 50%;
            z-index: 0;
        }
        
        .card-content {
            position: relative;
            z-index: 1;
        }

        .card-barang h5 {
            font-size: 13pt;
            font-weight: 700;
            margin-bottom: 12px;
            text-align: center;
            background: rgba(255,255,255,0.2);
            padding: 6px 12px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            letter-spacing: 0.5px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        .card-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .card-item {
            background: rgba(255,255,255,0.15);
            padding: 6px 8px;
            border-radius: 8px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .card-grid strong {
            display: block;
            font-size: 8pt;
            color: rgba(255,255,255,0.9);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 2px;
        }

        .card-grid p {
            font-size: 10pt;
            margin: 0;
            font-weight: 500;
            word-break: break-word;
            line-height: 1.3;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        
        /* Warna dengan sistem nomor */
        .color-number {
            position: absolute;
            top: 5px;
            left: 5px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 2px 6px;
            border-radius: 50%;
            font-size: 8pt;
            font-weight: bold;
            z-index: 2;
        }

        .print-button-container {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .filter-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr) auto;
            gap: 15px;
            align-items: end;
        }

        .grid-settings {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .grid-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .color-selector {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .color-selector h6 {
            margin-bottom: 15px;
            color: #333;
            font-weight: 600;
        }
        
        .color-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 8px;
            justify-content: center;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .color-option {
            width: 55px;
            height: 55px;
            border-radius: 10px;
            border: 2px solid #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            position: relative;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding: 3px;
        }
        
        .color-option:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .color-option.active {
            border-color: #333;
            transform: scale(1.1);
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
        }
        
        .color-option::after {
            content: '‚úì';
            position: absolute;
            top: 3px;
            right: 3px;
            color: white;
            font-weight: bold;
            font-size: 12px;
            background: rgba(0,0,0,0.7);
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .color-option.active::after {
            opacity: 1;
        }

        .color-number-display {
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 1px 4px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: bold;
        }
        
        /* 25 Dark Gradient Options dengan nomor */
        .gradient-1 { background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); }
        .gradient-2 { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); }
        .gradient-3 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .gradient-4 { background: linear-gradient(135deg, #134e5e 0%, #71b280 100%); }
        .gradient-5 { background: linear-gradient(135deg, #8b0000 0%, #b22222 100%); }
        .gradient-6 { background: linear-gradient(135deg, #2d5016 0%, #3e6b24 100%); }
        .gradient-7 { background: linear-gradient(135deg, #8b4513 0%, #a0522d 100%); }
        .gradient-8 { background: linear-gradient(135deg, #2c3e50 0%, #4a6741 100%); }
        .gradient-9 { background: linear-gradient(135deg, #36454f 0%, #2f4f4f 100%); }
        .gradient-10 { background: linear-gradient(135deg, #800080 0%, #4b0082 100%); }
        .gradient-11 { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); }
        .gradient-12 { background: linear-gradient(135deg, #4a148c 0%, #6a1b9a 100%); }
        .gradient-13 { background: linear-gradient(135deg, #0f3460 0%, #0c2d48 100%); }
        .gradient-14 { background: linear-gradient(135deg, #2e1065 0%, #200122 100%); }
        .gradient-15 { background: linear-gradient(135deg, #1b1b2f 0%, #162447 100%); }
        .gradient-16 { background: linear-gradient(135deg, #3c1361 0%, #52307c 100%); }
        .gradient-17 { background: linear-gradient(135deg, #000428 0%, #004e92 100%); }
        .gradient-18 { background: linear-gradient(135deg, #360033 0%, #0b8793 100%); }
        .gradient-19 { background: linear-gradient(135deg, #0f0c29 0%, #302b63 100%); }
        .gradient-20 { background: linear-gradient(135deg, #24243e 0%, #141e30 100%); }
        .gradient-21 { background: linear-gradient(135deg, #1a252f 0%, #2b5876 100%); }
        .gradient-22 { background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%); }
        .gradient-23 { background: linear-gradient(135deg, #414345 0%, #232526 100%); }
        .gradient-24 { background: linear-gradient(135deg, #1e130c 0%, #9a8478 100%); }
        .gradient-25 { background: linear-gradient(135deg, #2d1b69 0%, #11998e 100%); }
        
        .btn-print {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            border: none;
            padding: 12px 30px;
            font-weight: 600;
            border-radius: 25px;
            color: white;
            text-decoration: none;
            display: inline-block;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(44, 62, 80, 0.3);
        }
        
        .btn-print:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(44, 62, 80, 0.4);
            color: white;
        }
        
        .btn-secondary-custom {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
        }
        
        .btn-secondary-custom:hover {
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
        }
        
        /* Dynamic color classes dengan nomor urut */
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+1) { background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); }
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+2) { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); }
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+3) { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+4) { background: linear-gradient(135deg, #134e5e 0%, #71b280 100%); }
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+5) { background: linear-gradient(135deg, #8b0000 0%, #b22222 100%); }
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+6) { background: linear-gradient(135deg, #2d5016 0%, #3e6b24 100%); }
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+7) { background: linear-gradient(135deg, #8b4513 0%, #a0522d 100%); }
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+8) { background: linear-gradient(135deg, #2c3e50 0%, #4a6741 100%); }
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+9) { background: linear-gradient(135deg, #36454f 0%, #2f4f4f 100%); }
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+10) { background: linear-gradient(135deg, #800080 0%, #4b0082 100%); }
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+11) { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); }
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+12) { background: linear-gradient(135deg, #4a148c 0%, #6a1b9a 100%); }
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+13) { background: linear-gradient(135deg, #0f3460 0%, #0c2d48 100%); }
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+14) { background: linear-gradient(135deg, #2e1065 0%, #200122 100%); }
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+15) { background: linear-gradient(135deg, #1b1b2f 0%, #162447 100%); }
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+16) { background: linear-gradient(135deg, #3c1361 0%, #52307c 100%); }
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+17) { background: linear-gradient(135deg, #000428 0%, #004e92 100%); }
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+18) { background: linear-gradient(135deg, #360033 0%, #0b8793 100%); }
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+19) { background: linear-gradient(135deg, #0f0c29 0%, #302b63 100%); }
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+20) { background: linear-gradient(135deg, #24243e 0%, #141e30 100%); }
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+21) { background: linear-gradient(135deg, #1a252f 0%, #2b5876 100%); }
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+22) { background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%); }
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+23) { background: linear-gradient(135deg, #414345 0%, #232526 100%); }
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+24) { background: linear-gradient(135deg, #1e130c 0%, #9a8478 100%); }
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+25) { background: linear-gradient(135deg, #2d1b69 0%, #11998e 100%); }
        .cards-wrapper.color-numbered .card-barang:nth-child(25n+0) { background: linear-gradient(135deg, #2d1b69 0%, #11998e 100%); }

        /* Single color classes */
        .cards-wrapper.color-1 .card-barang { background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); }
        .cards-wrapper.color-2 .card-barang { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); }
        .cards-wrapper.color-3 .card-barang { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .cards-wrapper.color-4 .card-barang { background: linear-gradient(135deg, #134e5e 0%, #71b280 100%); }
        .cards-wrapper.color-5 .card-barang { background: linear-gradient(135deg, #8b0000 0%, #b22222 100%); }
        .cards-wrapper.color-6 .card-barang { background: linear-gradient(135deg, #2d5016 0%, #3e6b24 100%); }
        .cards-wrapper.color-7 .card-barang { background: linear-gradient(135deg, #8b4513 0%, #a0522d 100%); }
        .cards-wrapper.color-8 .card-barang { background: linear-gradient(135deg, #2c3e50 0%, #4a6741 100%); }
        .cards-wrapper.color-9 .card-barang { background: linear-gradient(135deg, #36454f 0%, #2f4f4f 100%); }
        .cards-wrapper.color-10 .card-barang { background: linear-gradient(135deg, #800080 0%, #4b0082 100%); }
        .cards-wrapper.color-11 .card-barang { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); }
        .cards-wrapper.color-12 .card-barang { background: linear-gradient(135deg, #4a148c 0%, #6a1b9a 100%); }
        .cards-wrapper.color-13 .card-barang { background: linear-gradient(135deg, #0f3460 0%, #0c2d48 100%); }
        .cards-wrapper.color-14 .card-barang { background: linear-gradient(135deg, #2e1065 0%, #200122 100%); }
        .cards-wrapper.color-15 .card-barang { background: linear-gradient(135deg, #1b1b2f 0%, #162447 100%); }
        .cards-wrapper.color-16 .card-barang { background: linear-gradient(135deg, #3c1361 0%, #52307c 100%); }
        .cards-wrapper.color-17 .card-barang { background: linear-gradient(135deg, #000428 0%, #004e92 100%); }
        .cards-wrapper.color-18 .card-barang { background: linear-gradient(135deg, #360033 0%, #0b8793 100%); }
        .cards-wrapper.color-19 .card-barang { background: linear-gradient(135deg, #0f0c29 0%, #302b63 100%); }
        .cards-wrapper.color-20 .card-barang { background: linear-gradient(135deg, #24243e 0%, #141e30 100%); }
        .cards-wrapper.color-21 .card-barang { background: linear-gradient(135deg, #1a252f 0%, #2b5876 100%); }
        .cards-wrapper.color-22 .card-barang { background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%); }
        .cards-wrapper.color-23 .card-barang { background: linear-gradient(135deg, #414345 0%, #232526 100%); }
        .cards-wrapper.color-24 .card-barang { background: linear-gradient(135deg, #1e130c 0%, #9a8478 100%); }
        .cards-wrapper.color-25 .card-barang { background: linear-gradient(135deg, #2d1b69 0%, #11998e 100%); }

        /* Grid variations + auto grid */
        .grid-auto { grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(5, auto); }
        .grid-2x3 { grid-template-columns: repeat(2, 1fr); grid-template-rows: repeat(3, auto); }
        .grid-2x4 { grid-template-columns: repeat(2, 1fr); grid-template-rows: repeat(4, auto); }
        .grid-3x3 { grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, auto); }
        .grid-3x4 { grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(4, auto); }
        .grid-3x5 { grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(5, auto); }
        .grid-4x4 { grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(4, auto); }
        .grid-4x5 { grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(5, auto); }
        
        /* Grid auto berdasarkan ukuran kertas */
        .grid-auto.paper-a4 { grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(5, auto); }
        .grid-auto.paper-a3 { grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(6, auto); }
        .grid-auto.paper-f4 { grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(5, auto); }

        /* Paper size styles */
        .paper-a3 { max-width: 1400px; }
        .paper-a4 { max-width: 1200px; }
        .paper-f4 { max-width: 1300px; }

        @media print {
            html {
                margin: 0 !important;
                padding: 0 !important;
                width: 100% !important;
                height: 100% !important;
            }
            body {
                background-color: white !important;
                margin: 0 !important;
                padding: 0 !important;
                width: 100% !important;
                height: 100% !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            @page {
                size: auto;
                margin: 0mm !important;
            }
            .print-button-container, .filter-container, .grid-settings, .color-selector {
                display: none !important;
            }
            .print-container {
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                margin: 0 !important;
                padding: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                max-width: none !important;
                box-shadow: none !important;
            }
            .cards-wrapper {
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                gap: 0 !important;
                width: 100% !important;
                height: 100% !important;
                display: grid !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            /* Ukuran kartu berdasarkan grid untuk A4 */
            .print-container.paper-a4 .cards-wrapper.grid-2x3 .card-barang { 
                width: calc((200mm - 4mm) / 2); 
                height: calc((287mm - 6mm) / 3); 
                min-height: calc((287mm - 6mm) / 3);
            }
            .print-container.paper-a4 .cards-wrapper.grid-2x4 .card-barang { 
                width: calc((200mm - 6mm) / 2); 
                height: calc((287mm - 8mm) / 4); 
                min-height: calc((287mm - 8mm) / 4);
            }
            .print-container.paper-a4 .cards-wrapper.grid-3x3 .card-barang { 
                width: calc((200mm - 6mm) / 3); 
                height: calc((287mm - 6mm) / 3); 
                min-height: calc((287mm - 6mm) / 3);
            }
            .print-container.paper-a4 .cards-wrapper.grid-3x4 .card-barang { 
                width: calc((200mm - 8mm) / 3); 
                height: calc((287mm - 8mm) / 4); 
                min-height: calc((287mm - 8mm) / 4);
            }
            .print-container.paper-a4 .cards-wrapper.grid-3x5 .card-barang { 
                width: calc((200mm - 10mm) / 3); 
                height: calc((287mm - 10mm) / 5); 
                min-height: calc((287mm - 10mm) / 5);
            }
            .print-container.paper-a4 .cards-wrapper.grid-4x4 .card-barang { 
                width: calc((200mm - 8mm) / 4); 
                height: calc((287mm - 8mm) / 4); 
                min-height: calc((287mm - 8mm) / 4);
            }
            .print-container.paper-a4 .cards-wrapper.grid-4x5 .card-barang { 
                width: calc((200mm - 10mm) / 4); 
                height: calc((287mm - 10mm) / 5); 
                min-height: calc((287mm - 10mm) / 5);
            }

            /* Ukuran kartu berdasarkan grid untuk A3 */
            .print-container.paper-a3 .cards-wrapper.grid-2x3 .card-barang { 
                width: calc((287mm - 4mm) / 2); 
                height: calc((410mm - 6mm) / 3); 
                min-height: calc((410mm - 6mm) / 3);
            }
            .print-container.paper-a3 .cards-wrapper.grid-2x4 .card-barang { 
                width: calc((287mm - 6mm) / 2); 
                height: calc((410mm - 8mm) / 4); 
                min-height: calc((410mm - 8mm) / 4);
            }
            .print-container.paper-a3 .cards-wrapper.grid-3x3 .card-barang { 
                width: calc((287mm - 6mm) / 3); 
                height: calc((410mm - 6mm) / 3); 
                min-height: calc((410mm - 6mm) / 3);
            }
            .print-container.paper-a3 .cards-wrapper.grid-3x4 .card-barang { 
                width: calc((287mm - 8mm) / 3); 
                height: calc((410mm - 8mm) / 4); 
                min-height: calc((410mm - 8mm) / 4);
            }
            .print-container.paper-a3 .cards-wrapper.grid-3x5 .card-barang { 
                width: calc((287mm - 10mm) / 3); 
                height: calc((410mm - 10mm) / 5); 
                min-height: calc((410mm - 10mm) / 5);
            }
            .print-container.paper-a3 .cards-wrapper.grid-4x4 .card-barang { 
                width: calc((287mm - 8mm) / 4); 
                height: calc((410mm - 8mm) / 4); 
                min-height: calc((410mm - 8mm) / 4);
            }
            .print-container.paper-a3 .cards-wrapper.grid-4x5 .card-barang { 
                width: calc((287mm - 10mm) / 4); 
                height: calc((410mm - 10mm) / 5); 
                min-height: calc((410mm - 10mm) / 5);
            }

            /* Ukuran kartu berdasarkan grid untuk F4 */
            .print-container.paper-f4 .cards-wrapper.grid-2x3 .card-barang { 
                width: calc((205mm - 4mm) / 2); 
                height: calc((320mm - 6mm) / 3); 
                min-height: calc((320mm - 6mm) / 3);
            }
            .print-container.paper-f4 .cards-wrapper.grid-2x4 .card-barang { 
                width: calc((205mm - 6mm) / 2); 
                height: calc((320mm - 8mm) / 4); 
                min-height: calc((320mm - 8mm) / 4);
            }
            .print-container.paper-f4 .cards-wrapper.grid-3x3 .card-barang { 
                width: calc((205mm - 6mm) / 3); 
                height: calc((320mm - 6mm) / 3); 
                min-height: calc((320mm - 6mm) / 3);
            }
            .print-container.paper-f4 .cards-wrapper.grid-3x4 .card-barang { 
                width: calc((205mm - 8mm) / 3); 
                height: calc((320mm - 8mm) / 4); 
                min-height: calc((320mm - 8mm) / 4);
            }
            .print-container.paper-f4 .cards-wrapper.grid-3x5 .card-barang { 
                width: calc((205mm - 10mm) / 3); 
                height: calc((320mm - 10mm) / 5); 
                min-height: calc((320mm - 10mm) / 5);
            }
            .print-container.paper-f4 .cards-wrapper.grid-4x4 .card-barang { 
                width: calc((205mm - 8mm) / 4); 
                height: calc((320mm - 8mm) / 4); 
                min-height: calc((320mm - 8mm) / 4);
            }
            .print-container.paper-f4 .cards-wrapper.grid-4x5 .card-barang { 
                width: calc((205mm - 10mm) / 4); 
                height: calc((320mm - 10mm) / 5); 
                min-height: calc((320mm - 10mm) / 5);
            }
            
            .card-barang {
                margin: 0 !important;
                border-radius: 0;
                padding: 2mm;
                box-sizing: border-box;
                box-shadow: none;
                border: 1px solid #2c3e50;
                page-break-inside: avoid;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                overflow: hidden;
                display: flex;
                flex-direction: column;
            }
            .card-barang h5 {
                font-size: 9pt;
                margin-bottom: 4mm;
                padding: 2mm 3mm;
                border-radius: 8px;
            }
            .card-grid {
                gap: 1.5mm;
            }
            .card-item {
                padding: 1.5mm 2mm;
                border-radius: 4px;
            }
            .card-grid strong {
                font-size: 6pt;
                margin-bottom: 1mm;
            }
            .card-grid p {
                font-size: 7pt;
                line-height: 1.2;
            }
            .color-number {
                top: 1mm;
                left: 1mm;
                padding: 0.5mm 2mm;
                font-size: 6pt;
                border-radius: 8px;
            }
        }
        
        @media (max-width: 768px) {
            .grid-controls {
                grid-template-columns: 1fr;
            }
            .filter-row {
                grid-template-columns: 1fr;
            }
            .cards-wrapper {
                justify-content: center;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            }
        }
    </style>
</head>
<body>

    <div class="print-container paper-a4" id="printContainer">
        <div class="filter-container">
            <h5 class="mb-3 fw-bold text-center">Filter Kartu Peserta</h5>
            <form method="GET" action="{{ url_for('admin.cetak_kartu') }}">
                <div class="filter-row">
                    <div class="col">
                        <label for="nama" class="form-label">Nama Pendaftar</label>
                        <input type="text" name="nama" id="nama" class="form-control" placeholder="Cari Nama..." value="{{ request.args.get('nama', '') }}">
                    </div>
                    <div class="col">
                        <label for="rombongan_id" class="form-label">Rombongan</label>
                        <select name="rombongan_id" id="rombongan_id" class="form-select">
                            <option value="">-- Semua --</option>
                            {% for rombongan in rombongan_for_filter %}
                                <option value="{{ rombongan.id }}" {% if request.args.get('rombongan_id')|int == rombongan.id %}selected{% endif %}>
                                    {{ rombongan.nama_rombongan }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col">
                        <label for="jenis_kelamin" class="form-label">Jenis Kelamin</label>
                        <select class="form-select" id="jenis_kelamin" name="jenis_kelamin">
                            <option value="">Semua</option>
                            <option value="PUTRA" {% if request.args.get('jenis_kelamin') == 'PUTRA' %}selected{% endif %}>Putra</option>
                            <option value="PUTRI" {% if request.args.get('jenis_kelamin') == 'PUTRI' %}selected{% endif %}>Putri</option>
                        </select>
                    </div>
                    <div class="col">
                        <label for="perjalanan" class="form-label">Perjalanan</label>
                        <select name="perjalanan" id="perjalanan" class="form-select">
                            <option value="">-- Semua --</option>
                            <option value="pulang" {% if request.args.get('perjalanan') == 'pulang' %}selected{% endif %}>Pulang</option>
                            <option value="kembali" {% if request.args.get('perjalanan') == 'kembali' %}selected{% endif %}>Kembali</option>
                        </select>
                    </div>
                    <div class="col">
                        <button type="submit" class="btn btn-primary">Terapkan</button>
                    </div>
                </div>
            </form>
        </div>

        <div class="grid-settings">
            <h5 class="mb-3 fw-bold text-center">Pengaturan Layout & Cetak</h5>
            <div class="grid-controls">
                <div>
                    <label class="form-label fw-bold">-Grid Layout (Horizontal x Vertikal)-<br>Untuk grid 2x4 terkadang eror, jadi untuk merefreshnya cukup pilih grid lain dan pilih grid 2x3 dan 2x4. biasanya teradi eror ketika menentukan warna. maka kami merekomendasikan untuk memilih warna dulu baru grid. Untuk yang auto grid sudah normal</label>
                    <select class="form-select" id="gridSelect">
                        <option value="auto">Auto (Sesuaikan Kertas)</option>
                        <option value="grid-2x3">2 √ó 3 (6 kartu)</option>
                        <option value="grid-2x4">2 √ó 4 (8 kartu)</option>
                        <!-- <option value="grid-3x3">3 √ó 3 (9 kartu)</option>
                        <option value="grid-3x4">3 √ó 4 (12 kartu)</option>
                        <option value="grid-3x5" selected>3 √ó 5 (15 kartu)</option>
                        <option value="grid-4x4">4 √ó 4 (16 kartu)</option>
                        <option value="grid-4x5">4 √ó 5 (20 kartu)</option> -->
                    </select>
                </div>
                <div>
                    <label class="form-label fw-bold">-Ukuran Kertas-<br>Jangan lupa untuk menyamakan ukuran kertas di driver printernya jga saat hendak ngeprint yaa</label>
                    <select class="form-select" id="paperSelect">
                        <option value="paper-a4" selected>A4 (210 √ó 297 mm)</option>
                        <option value="paper-a3">A3 (297 √ó 420 mm)</option>
                        <option value="paper-f4">F4 (215 √ó 330 mm)</option>
                    </select>
                </div>
                <div>
                    <label class="form-label fw-bold">-Mode Warna-<br>Piliha warna tungal, untuk warna berurutan hanya untuk sample</label>
                    <select class="form-select" id="colorModeSelect">
                        <option value="single">Warna Tunggal</option>
                        <option value="numbered" selected>Warna Berurutan dengan Nomor</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="color-selector">
            <h6>Pilih Warna Kartu (25 Pilihan Gradient Gelap)</h6>
            <div class="mb-3">
                <small class="text-muted">
                    <strong>Mode Warna Tunggal:</strong> Semua kartu menggunakan warna yang sama<br>
                    <strong>Mode Berurutan:</strong> Kartu menggunakan warna berbeda dengan nomor urut (1-25, lalu ulang)
                </small>
            </div>
            <div class="color-options">
                <div class="color-option gradient-1 active" data-color="1" title="Navy Slate">
                    <div class="color-number-display">1</div>
                </div>
                <div class="color-option gradient-2" data-color="2" title="Ocean Deep">
                    <div class="color-number-display">2</div>
                </div>
                <div class="color-option gradient-3" data-color="3" title="Purple Dusk">
                    <div class="color-number-display">3</div>
                </div>
                <div class="color-option gradient-4" data-color="4" title="Forest Teal">
                    <div class="color-number-display">4</div>
                </div>
                <div class="color-option gradient-5" data-color="5" title="Dark Crimson">
                    <div class="color-number-display">5</div>
                </div>
                <div class="color-option gradient-6" data-color="6" title="Forest Green">
                    <div class="color-number-display">6</div>
                </div>
                <div class="color-option gradient-7" data-color="7" title="Chocolate Wood">
                    <div class="color-number-display">7</div>
                </div>
                <div class="color-option gradient-8" data-color="8" title="Midnight Forest">
                    <div class="color-number-display">8</div>
                </div>
                <div class="color-option gradient-9" data-color="9" title="Steel Gray">
                    <div class="color-number-display">9</div>
                </div>
                <div class="color-option gradient-10" data-color="10" title="Royal Purple">
                    <div class="color-number-display">10</div>
                </div>
                <div class="color-option gradient-11" data-color="11" title="Dark Navy">
                    <div class="color-number-display">11</div>
                </div>
                <div class="color-option gradient-12" data-color="12" title="Deep Violet">
                    <div class="color-number-display">12</div>
                </div>
                <div class="color-option gradient-13" data-color="13" title="Ocean Blue">
                    <div class="color-number-display">13</div>
                </div>
                <div class="color-option gradient-14" data-color="14" title="Mystic Purple">
                    <div class="color-number-display">14</div>
                </div>
                <div class="color-option gradient-15" data-color="15" title="Space Blue">
                    <div class="color-number-display">15</div>
                </div>
                <div class="color-option gradient-16" data-color="16" title="Galaxy Purple">
                    <div class="color-number-display">16</div>
                </div>
                <div class="color-option gradient-17" data-color="17" title="Deep Ocean">
                    <div class="color-number-display">17</div>
                </div>
                <div class="color-option gradient-18" data-color="18" title="Emerald Night">
                    <div class="color-number-display">18</div>
                </div>
                <div class="color-option gradient-19" data-color="19" title="Cosmic Purple">
                    <div class="color-number-display">19</div>
                </div>
                <div class="color-option gradient-20" data-color="20" title="Midnight Blue">
                    <div class="color-number-display">20</div>
                </div>
                <div class="color-option gradient-21" data-color="21" title="Arctic Blue">
                    <div class="color-number-display">21</div>
                </div>
                <div class="color-option gradient-22" data-color="22" title="Twilight Blue">
                    <div class="color-number-display">22</div>
                </div>
                <div class="color-option gradient-23" data-color="23" title="Carbon Gray">
                    <div class="color-number-display">23</div>
                </div>
                <div class="color-option gradient-24" data-color="24" title="Coffee Brown">
                    <div class="color-number-display">24</div>
                </div>
                <div class="color-option gradient-25" data-color="25" title="Teal Mystery">
                    <div class="color-number-display">25</div>
                </div>
            </div>
        </div>

        <div class="print-button-container">
            <button class="btn-print" onclick="window.print()">
                <i class="fas fa-print"></i> Cetak Semua Kartu ({{ semua_pendaftar|length * 2 if semua_pendaftar else 0 }} kartu)
            </button>
            <a href="{{ url_for('admin.dashboard') }}" class="btn-print btn-secondary-custom">
                ‚Üê Kembali ke Dashboard
            </a>
        </div>
        
        <div class="cards-wrapper color-numbered" id="cardsWrapper">
            {% for pendaftar in semua_pendaftar %}
                {# Cetak kartu pertama untuk santri #}
                <div class="card-barang">
                    <div class="color-number">{{ loop.index }}</div>
                    <div class="card-content">
                        <h5>KARTU BARANG {{ 'PUTRA' if pendaftar.santri.jenis_kelamin == 'PUTRA' else 'PUTRI' }}</h5>
                        <div class="card-grid">
                            <div class="card-item">
                                <strong>üë§ Nama Santri</strong>
                                <p>{{ pendaftar.santri.nama }}</p>
                            </div>
                            <div class="card-item">
                                <strong>üìç WA Wali</strong>
                                <p>{{ pendaftar.santri.no_hp_wali or '-' }}</p>
                            </div>
                            <div class="card-item">
                                <strong>üë• Rombongan</strong>
                                <p>{{ pendaftar.rombongan_pulang.nama_rombongan if pendaftar.rombongan_pulang else 'N/A' }}</p>
                            </div>
                            <div class="card-item">
                                <strong>üìå Titik Turun</strong>
                                <p>{{ pendaftar.titik_turun or '-' }}</p>
                            </div>
                            <div class="card-item" style="grid-column: span 2;">
                                <strong>üöå Nama Bus</strong>
                                <p>{{ pendaftar.bus_pulang.nama_armada if pendaftar.bus_pulang else '-' }} - {{ pendaftar.bus_pulang.nomor_lambung or pendaftar.bus_pulang.plat_nomor or '-' }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                {# Cetak kartu kedua (identik) #}
                <div class="card-barang">
                    <div class="color-number">{{ loop.index }}</div>
                    <div class="card-content">
                        <h5>KARTU BARANG {{ 'PUTRA' if pendaftar.santri.jenis_kelamin == 'PUTRA' else 'PUTRI' }}</h5>
                        <div class="card-grid">
                            <div class="card-item">
                                <strong>üë§ Nama Santri</strong>
                                <p>{{ pendaftar.santri.nama }}</p>
                            </div>
                            <div class="card-item">
                                <strong>üìç WA Wali</strong>
                                <p>{{ pendaftar.santri.no_hp_wali or '-' }}</p>
                            </div>
                            <div class="card-item">
                                <strong>üë• Rombongan</strong>
                                <p>{{ pendaftar.rombongan_pulang.nama_rombongan if pendaftar.rombongan_pulang else 'N/A' }}</p>
                            </div>
                            <div class="card-item">
                                <strong>üìå Titik Turun</strong>
                                <p>{{ pendaftar.titik_turun or '-' }}</p>
                            </div>
                            <div class="card-item" style="grid-column: span 2;">
                                <strong>üöå Nama Bus</strong>
                                <p>{{ pendaftar.bus_pulang.nama_armada if pendaftar.bus_pulang else '-' }} - {{ pendaftar.bus_pulang.nomor_lambung or pendaftar.bus_pulang.plat_nomor or '-' }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="alert alert-warning" style="grid-column: 1 / -1;">
                    <h5>‚ö†Ô∏è Tidak Ada Data</h5>
                    <p>Tidak ada data santri terdaftar di rombongan yang Anda kelola untuk dicetak.</p>
                </div>
            {% endfor %}
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const colorOptions = document.querySelectorAll('.color-option');
            const cardsWrapper = document.getElementById('cardsWrapper');
            const printContainer = document.getElementById('printContainer');
            const gridSelect = document.getElementById('gridSelect');
            const paperSelect = document.getElementById('paperSelect');
            const colorModeSelect = document.getElementById('colorModeSelect');
            let currentColorMode = 'numbered';
            let currentSelectedColor = '1';

            // Fungsi untuk update nomor urut pada kartu
            function updateCardNumbers() {
                const cards = document.querySelectorAll('.card-barang');
                cards.forEach((card, index) => {
                    let colorNumber = card.querySelector('.color-number');
                    if (!colorNumber) {
                        colorNumber = document.createElement('div');
                        colorNumber.className = 'color-number';
                        card.appendChild(colorNumber);
                    }
                    
                    if (currentColorMode === 'numbered') {
                        const colorIndex = (index % 25) + 1;
                        colorNumber.textContent = colorIndex;
                        colorNumber.style.display = 'block';
                    } else {
                        colorNumber.style.display = 'none';
                    }
                });
            }

            // Fungsi untuk update warna berdasarkan mode
            function updateColors() {
                cardsWrapper.className = 'cards-wrapper';
                
                if (currentColorMode === 'numbered') {
                    cardsWrapper.classList.add('color-numbered');
                } else {
                    cardsWrapper.classList.add('color-' + currentSelectedColor);
                }
                
                updateCardNumbers();
            }

            // Event listener untuk grid selection
            gridSelect.addEventListener('change', function() {
                // Hapus semua class grid sebelumnya
                cardsWrapper.className = cardsWrapper.className.replace(/grid-\w+/g, '');
                
                if (this.value === 'auto') {
                    cardsWrapper.classList.add('grid-auto');
                } else {
                    cardsWrapper.classList.add(this.value);
                }
                
                // Update grid info
                updateGridInfo();
            });

            // Fungsi untuk update info grid
            function updateGridInfo() {
                const gridInfo = {
                    'auto': { 'paper-a4': 15, 'paper-a3': 24, 'paper-f4': 15 },
                    'grid-2x3': 6,
                    'grid-2x4': 8,
                    'grid-3x3': 9,
                    'grid-3x4': 12,
                    'grid-3x5': 15,
                    'grid-4x4': 16,
                    'grid-4x5': 20
                };
                
                const selectedGrid = gridSelect.value;
                const selectedPaper = paperSelect.value;
                let maxCards;
                
                if (selectedGrid === 'auto') {
                    maxCards = gridInfo.auto[selectedPaper] || 15;
                } else {
                    maxCards = gridInfo[selectedGrid] || 15;
                }
                
                const printButton = document.querySelector('.btn-print');
                const currentCards = document.querySelectorAll('.card-barang').length;
                
                if (currentCards > maxCards) {
                    printButton.innerHTML = `<i class="fas fa-print"></i> Cetak ${maxCards} Kartu (${currentCards - maxCards} kartu akan terpotong)`;
                    printButton.style.background = 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)';
                } else {
                    printButton.innerHTML = `<i class="fas fa-print"></i> Cetak ${currentCards} Kartu`;
                    printButton.style.background = 'linear-gradient(135deg, #2c3e50 0%, #34495e 100%)';
                }
            }

            // Event listener untuk paper size selection
            paperSelect.addEventListener('change', function() {
                printContainer.className = printContainer.className.replace(/paper-\w+/g, '');
                printContainer.classList.add('print-container', this.value);
            });

            // Event listener untuk color mode selection
            colorModeSelect.addEventListener('change', function() {
                currentColorMode = this.value;
                updateColors();
                
                // Update visual feedback pada color options
                if (currentColorMode === 'numbered') {
                    colorOptions.forEach(opt => {
                        opt.style.opacity = '0.7';
                        opt.style.pointerEvents = 'none';
                    });
                    document.querySelector('.color-option.active').style.opacity = '1';
                } else {
                    colorOptions.forEach(opt => {
                        opt.style.opacity = '1';
                        opt.style.pointerEvents = 'auto';
                    });
                }
            });

            // Event listener untuk color selection
            colorOptions.forEach(option => {
                option.addEventListener('click', function() {
                    if (currentColorMode === 'single') {
                        // Hapus active dari semua opsi
                        colorOptions.forEach(opt => opt.classList.remove('active'));
                        
                        // Tambah active ke opsi yang dipilih
                        this.classList.add('active');
                        
                        currentSelectedColor = this.getAttribute('data-color');
                        updateColors();
                    }
                });
            });

            // Inisialisasi tampilan
            updateColors();
            
            // Set grid default
            cardsWrapper.classList.add('grid-3x5');

            // Preview effects saat hover (hanya untuk mode single)
            colorOptions.forEach(option => {
                option.addEventListener('mouseenter', function() {
                    if (currentColorMode === 'single' && !this.classList.contains('active')) {
                        const tempColor = this.getAttribute('data-color');
                        cardsWrapper.style.transition = 'all 0.3s ease';
                        
                        const originalClass = cardsWrapper.className;
                        cardsWrapper.className = 'cards-wrapper color-' + tempColor;
                        
                        this.addEventListener('mouseleave', function() {
                            setTimeout(() => {
                                if (!document.querySelector('.color-option:hover')) {
                                    cardsWrapper.className = originalClass;
                                }
                            }, 100);
                        }, { once: true });
                    }
                });
            });

            // Informasi jumlah kartu berdasarkan grid
            gridSelect.addEventListener('change', function() {
                const gridInfo = {
                    'grid-2x3': 6,
                    'grid-2x4': 8,
                    'grid-3x3': 9,
                    'grid-3x4': 12,
                    'grid-3x5': 15,
                    'grid-4x4': 16,
                    'grid-4x5': 20
                };
                
                const maxCards = gridInfo[this.value] || 15;
                const printButton = document.querySelector('.btn-print');
                const currentCards = document.querySelectorAll('.card-barang').length;
                
                if (currentCards > maxCards) {
                    printButton.innerHTML = `<i class="fas fa-print"></i> Cetak ${maxCards} Kartu (${currentCards - maxCards} kartu akan terpotong)`;
                    printButton.style.background = 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)';
                } else {
                    printButton.innerHTML = `<i class="fas fa-print"></i> Cetak ${currentCards} Kartu`;
                    printButton.style.background = 'linear-gradient(135deg, #2c3e50 0%, #34495e 100%)';
                }
            });

            // Trigger grid change event untuk set informasi awal
            gridSelect.dispatchEvent(new Event('change'));
        });
    </script>

</body>
</html>