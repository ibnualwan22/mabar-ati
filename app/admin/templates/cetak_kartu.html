<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cetak Kartu Barang Santri</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap');
        
        body {
            background-color: #f0f2f5;
            font-family: 'Poppins', sans-serif;
        }
        
        .print-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .cards-wrapper {
            display: grid;
            gap: 3mm;
            justify-content: center;
            /* Default grid 3x5 */
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(5, auto);
        }

        .card-barang {
            border: 3px solid #2c3e50;
            border-radius: 12px;
            padding: 8mm;
            box-sizing: border-box;
            page-break-inside: avoid;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            min-height: 70mm;
        }
        
        .card-barang::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100px;
            height: 100px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            z-index: 0;
        }
        
        .card-barang::after {
            content: '';
            position: absolute;
            bottom: -30px;
            left: -30px;
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.08);
            border-radius: 50%;
            z-index: 0;
        }
        
        .card-content {
            position: relative;
            z-index: 1;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .card-barang h5 {
            font-size: clamp(10pt, 2.5vw, 16pt);
            font-weight: 800;
            margin-bottom: 8px;
            text-align: center;
            background: rgba(0,0,0,0.4);
            padding: 6px 12px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.5);
            letter-spacing: 1px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            color: white;
            text-transform: uppercase;
        }

        .card-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            flex-grow: 1;
        }
        
        .card-item {
            background: rgba(0,0,0,0.3);
            padding: 4px 6px;
            border-radius: 8px;
            backdrop-filter: blur(5px);
            border: 2px solid rgba(255,255,255,0.3);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .card-grid strong {
            display: block;
            font-size: clamp(6pt, 1.5vw, 10pt);
            color: rgba(255,255,255,1);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 2px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        .card-grid p {
            font-size: clamp(7pt, 1.8vw, 12pt);
            margin: 0;
            font-weight: 600;
            word-break: break-word;
            line-height: 1.2;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
            color: white;
        }

        .print-button-container {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .filter-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr) auto;
            gap: 15px;
            align-items: end;
        }

        .grid-settings {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .grid-controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .color-selector {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .color-selector h6 {
            margin-bottom: 15px;
            color: #333;
            font-weight: 600;
        }
        
        .color-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 8px;
            justify-content: center;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .color-option {
            width: 55px;
            height: 55px;
            border-radius: 10px;
            border: 2px solid #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            position: relative;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding: 3px;
        }
        
        .color-option:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .color-option.active {
            border-color: #333;
            transform: scale(1.1);
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
        }
        
        .color-option::after {
            content: '✓';
            position: absolute;
            top: 3px;
            right: 3px;
            color: white;
            font-weight: bold;
            font-size: 12px;
            background: rgba(0,0,0,0.7);
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .color-option.active::after {
            opacity: 1;
        }

        .color-number-display {
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 1px 4px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: bold;
        }
        
        /* 25 pilihan warna tunggal seperti aslinya */
        .gradient-1 { background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); }
        .gradient-2 { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); }
        .gradient-3 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .gradient-4 { background: linear-gradient(135deg, #134e5e 0%, #71b280 100%); }
        .gradient-5 { background: linear-gradient(135deg, #8b0000 0%, #b22222 100%); }
        .gradient-6 { background: linear-gradient(135deg, #2d5016 0%, #3e6b24 100%); }
        .gradient-7 { background: linear-gradient(135deg, #8b4513 0%, #a0522d 100%); }
        .gradient-8 { background: linear-gradient(135deg, #2c3e50 0%, #4a6741 100%); }
        .gradient-9 { background: linear-gradient(135deg, #36454f 0%, #2f4f4f 100%); }
        .gradient-10 { background: linear-gradient(135deg, #800080 0%, #4b0082 100%); }
        .gradient-11 { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); }
        .gradient-12 { background: linear-gradient(135deg, #4a148c 0%, #6a1b9a 100%); }
        .gradient-13 { background: linear-gradient(135deg, #0f3460 0%, #0c2d48 100%); }
        .gradient-14 { background: linear-gradient(135deg, #2e1065 0%, #200122 100%); }
        .gradient-15 { background: linear-gradient(135deg, #1b1b2f 0%, #162447 100%); }
        .gradient-16 { background: linear-gradient(135deg, #3c1361 0%, #52307c 100%); }
        .gradient-17 { background: linear-gradient(135deg, #000428 0%, #004e92 100%); }
        .gradient-18 { background: linear-gradient(135deg, #360033 0%, #0b8793 100%); }
        .gradient-19 { background: linear-gradient(135deg, #0f0c29 0%, #302b63 100%); }
        .gradient-20 { background: linear-gradient(135deg, #24243e 0%, #141e30 100%); }
        .gradient-21 { background: linear-gradient(135deg, #1a252f 0%, #2b5876 100%); }
        .gradient-22 { background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%); }
        .gradient-23 { background: linear-gradient(135deg, #414345 0%, #232526 100%); }
        .gradient-24 { background: linear-gradient(135deg, #1e130c 0%, #9a8478 100%); }
        .gradient-25 { background: linear-gradient(135deg, #2d1b69 0%, #11998e 100%); }

        /* Single color classes untuk 25 warna */
        .cards-wrapper.color-1 .card-barang { background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); }
        .cards-wrapper.color-2 .card-barang { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); }
        .cards-wrapper.color-3 .card-barang { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .cards-wrapper.color-4 .card-barang { background: linear-gradient(135deg, #134e5e 0%, #71b280 100%); }
        .cards-wrapper.color-5 .card-barang { background: linear-gradient(135deg, #8b0000 0%, #b22222 100%); }
        .cards-wrapper.color-6 .card-barang { background: linear-gradient(135deg, #2d5016 0%, #3e6b24 100%); }
        .cards-wrapper.color-7 .card-barang { background: linear-gradient(135deg, #8b4513 0%, #a0522d 100%); }
        .cards-wrapper.color-8 .card-barang { background: linear-gradient(135deg, #2c3e50 0%, #4a6741 100%); }
        .cards-wrapper.color-9 .card-barang { background: linear-gradient(135deg, #36454f 0%, #2f4f4f 100%); }
        .cards-wrapper.color-10 .card-barang { background: linear-gradient(135deg, #800080 0%, #4b0082 100%); }
        .cards-wrapper.color-11 .card-barang { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); }
        .cards-wrapper.color-12 .card-barang { background: linear-gradient(135deg, #4a148c 0%, #6a1b9a 100%); }
        .cards-wrapper.color-13 .card-barang { background: linear-gradient(135deg, #0f3460 0%, #0c2d48 100%); }
        .cards-wrapper.color-14 .card-barang { background: linear-gradient(135deg, #2e1065 0%, #200122 100%); }
        .cards-wrapper.color-15 .card-barang { background: linear-gradient(135deg, #1b1b2f 0%, #162447 100%); }
        .cards-wrapper.color-16 .card-barang { background: linear-gradient(135deg, #3c1361 0%, #52307c 100%); }
        .cards-wrapper.color-17 .card-barang { background: linear-gradient(135deg, #000428 0%, #004e92 100%); }
        .cards-wrapper.color-18 .card-barang { background: linear-gradient(135deg, #360033 0%, #0b8793 100%); }
        .cards-wrapper.color-19 .card-barang { background: linear-gradient(135deg, #0f0c29 0%, #302b63 100%); }
        .cards-wrapper.color-20 .card-barang { background: linear-gradient(135deg, #24243e 0%, #141e30 100%); }
        .cards-wrapper.color-21 .card-barang { background: linear-gradient(135deg, #1a252f 0%, #2b5876 100%); }
        .cards-wrapper.color-22 .card-barang { background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%); }
        .cards-wrapper.color-23 .card-barang { background: linear-gradient(135deg, #414345 0%, #232526 100%); }
        .cards-wrapper.color-24 .card-barang { background: linear-gradient(135deg, #1e130c 0%, #9a8478 100%); }
        .cards-wrapper.color-25 .card-barang { background: linear-gradient(135deg, #2d1b69 0%, #11998e 100%); }

        /* Grid variations + auto grid */
        .grid-auto { grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(5, auto); }
        .grid-2x3 { grid-template-columns: repeat(2, 1fr); grid-template-rows: repeat(3, auto); }
        .grid-2x4 { grid-template-columns: repeat(2, 1fr); grid-template-rows: repeat(4, auto); }
        
        /* Grid auto berdasarkan ukuran kertas */
        .grid-auto.paper-a4 { grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(5, auto); }
        .grid-auto.paper-a3 { grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(6, auto); }
        .grid-auto.paper-f4 { grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(5, auto); }

        /* Paper size styles */
        .paper-a3 { max-width: 1400px; }
        .paper-a4 { max-width: 1200px; }
        .paper-f4 { max-width: 1300px; }

        /* Responsive font sizing berdasarkan grid */
        .grid-2x3 .card-barang h5 { font-size: clamp(12pt, 3vw, 18pt); }
        .grid-2x3 .card-grid strong { font-size: clamp(8pt, 2vw, 12pt); }
        .grid-2x3 .card-grid p { font-size: clamp(9pt, 2.2vw, 14pt); }

        .grid-2x4 .card-barang h5 { font-size: clamp(10pt, 2.5vw, 16pt); }
        .grid-2x4 .card-grid strong { font-size: clamp(7pt, 1.8vw, 11pt); }
        .grid-2x4 .card-grid p { font-size: clamp(8pt, 2vw, 13pt); }

        .grid-auto .card-barang h5 { font-size: clamp(9pt, 2.2vw, 15pt); }
        .grid-auto .card-grid strong { font-size: clamp(6pt, 1.6vw, 10pt); }
        .grid-auto .card-grid p { font-size: clamp(7pt, 1.8vw, 12pt); }

        .btn-print {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            border: none;
            padding: 12px 30px;
            font-weight: 600;
            border-radius: 25px;
            color: white;
            text-decoration: none;
            display: inline-block;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(44, 62, 80, 0.3);
        }
        
        .btn-print:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(44, 62, 80, 0.4);
            color: white;
        }
        
        .btn-secondary-custom {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
        }
        
        .btn-secondary-custom:hover {
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
        }

        @media print {
            html {
                margin: 0 !important;
                padding: 0 !important;
                width: 100% !important;
                height: 100% !important;
            }
            body {
                background-color: white !important;
                margin: 0 !important;
                padding: 0 !important;
                width: 100% !important;
                height: 100% !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            @page {
                size: auto;
                margin: 0mm !important;
            }
            .print-button-container, .filter-container, .grid-settings, .color-selector {
                display: none !important;
            }
            .print-container {
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                margin: 0 !important;
                padding: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                max-width: none !important;
                box-shadow: none !important;
            }
            .cards-wrapper {
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                gap: 0 !important;
                width: 100% !important;
                height: 100% !important;
                display: grid !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            /* Ukuran kartu berdasarkan grid untuk A4 */
            .print-container.paper-a4 .cards-wrapper.grid-2x3 .card-barang { 
                width: calc((200mm - 4mm) / 2); 
                height: calc((287mm - 6mm) / 3); 
                min-height: calc((287mm - 6mm) / 3);
            }
            .print-container.paper-a4 .cards-wrapper.grid-2x4 .card-barang { 
                width: calc((200mm - 6mm) / 2); 
                height: calc((287mm - 8mm) / 4); 
                min-height: calc((287mm - 8mm) / 4);
            }
            .print-container.paper-a4 .cards-wrapper.grid-auto .card-barang { 
                width: calc((200mm - 10mm) / 3); 
                height: calc((287mm - 10mm) / 5); 
                min-height: calc((287mm - 10mm) / 5);
            }

            /* Ukuran kartu berdasarkan grid untuk A3 */
            .print-container.paper-a3 .cards-wrapper.grid-2x3 .card-barang { 
                width: calc((287mm - 4mm) / 2); 
                height: calc((410mm - 6mm) / 3); 
                min-height: calc((410mm - 6mm) / 3);
            }
            .print-container.paper-a3 .cards-wrapper.grid-2x4 .card-barang { 
                width: calc((287mm - 6mm) / 2); 
                height: calc((410mm - 8mm) / 4); 
                min-height: calc((410mm - 8mm) / 4);
            }
            .print-container.paper-a3 .cards-wrapper.grid-auto .card-barang { 
                width: calc((287mm - 10mm) / 4); 
                height: calc((410mm - 10mm) / 6); 
                min-height: calc((410mm - 10mm) / 6);
            }

            /* Ukuran kartu berdasarkan grid untuk F4 */
            .print-container.paper-f4 .cards-wrapper.grid-2x3 .card-barang { 
                width: calc((205mm - 4mm) / 2); 
                height: calc((320mm - 6mm) / 3); 
                min-height: calc((320mm - 6mm) / 3);
            }
            .print-container.paper-f4 .cards-wrapper.grid-2x4 .card-barang { 
                width: calc((205mm - 6mm) / 2); 
                height: calc((320mm - 8mm) / 4); 
                min-height: calc((320mm - 8mm) / 4);
            }
            .print-container.paper-f4 .cards-wrapper.grid-auto .card-barang { 
                width: calc((205mm - 10mm) / 3); 
                height: calc((320mm - 10mm) / 5); 
                min-height: calc((320mm - 10mm) / 5);
            }
            
            .card-barang {
                margin: 0 !important;
                border-radius: 0;
                padding: 3mm;
                box-sizing: border-box;
                box-shadow: none;
                border: 2px solid #2c3e50;
                page-break-inside: avoid;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                overflow: hidden;
                display: flex;
                flex-direction: column;
            }
            .card-barang h5 {
                font-size: 11pt !important;
                margin-bottom: 4mm;
                padding: 2mm 3mm;
                border-radius: 6px;
                font-weight: 800 !important;
            }
            .card-grid {
                gap: 2mm;
            }
            .card-item {
                padding: 2mm;
                border-radius: 4px;
            }
            .card-grid strong {
                font-size: 8pt !important;
                margin-bottom: 1mm;
                font-weight: 700 !important;
            }
            .card-grid p {
                font-size: 9pt !important;
                line-height: 1.2;
                font-weight: 600 !important;
            }
            
            /* Ukuran font print berdasarkan grid */
            .grid-2x3 .card-barang h5 { font-size: 14pt !important; }
            .grid-2x3 .card-grid strong { font-size: 10pt !important; }
            .grid-2x3 .card-grid p { font-size: 11pt !important; }

            .grid-2x4 .card-barang h5 { font-size: 12pt !important; }
            .grid-2x4 .card-grid strong { font-size: 9pt !important; }
            .grid-2x4 .card-grid p { font-size: 10pt !important; }
        }
        
        @media (max-width: 768px) {
            .grid-controls {
                grid-template-columns: 1fr;
            }
            .filter-row {
                grid-template-columns: 1fr;
            }
            .cards-wrapper {
                justify-content: center;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            }
        }
    </style>
</head>
<body>

    <div class="print-container paper-a4" id="printContainer">
        <div class="filter-container">
            <h5 class="mb-3 fw-bold text-center">Filter Kartu Peserta</h5>
            <form method="GET" action="{{ url_for('admin.cetak_kartu') }}">
                <div class="filter-row">
                    <div class="col">
                        <label for="nama" class="form-label">Nama Pendaftar</label>
                        <input type="text" name="nama" id="nama" class="form-control" placeholder="Cari Nama..." value="{{ request.args.get('nama', '') }}">
                    </div>
                    <div class="col">
                        <label for="rombongan_id" class="form-label">Rombongan</label>
                        <select name="rombongan_id" id="rombongan_id" class="form-select">
                            <option value="">-- Semua --</option>
                            {% for rombongan in rombongan_for_filter %}
                                <option value="{{ rombongan.id }}" {% if request.args.get('rombongan_id')|int == rombongan.id %}selected{% endif %}>
                                    {{ rombongan.nama_rombongan }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col">
                        <label for="jenis_kelamin" class="form-label">Jenis Kelamin</label>
                        <select class="form-select" id="jenis_kelamin" name="jenis_kelamin">
                            <option value="">Semua</option>
                            <option value="PUTRA" {% if request.args.get('jenis_kelamin') == 'PUTRA' %}selected{% endif %}>Putra</option>
                            <option value="PUTRI" {% if request.args.get('jenis_kelamin') == 'PUTRI' %}selected{% endif %}>Putri</option>
                        </select>
                    </div>
                    <div class="col">
                        <label for="perjalanan" class="form-label">Perjalanan</label>
                        <select name="perjalanan" id="perjalanan" class="form-select">
                            <option value="">-- Semua --</option>
                            <option value="pulang" {% if request.args.get('perjalanan') == 'pulang' %}selected{% endif %}>Pulang</option>
                            <option value="kembali" {% if request.args.get('perjalanan') == 'kembali' %}selected{% endif %}>Kembali</option>
                        </select>
                    </div>
                    <div class="col">
                        <button type="submit" class="btn btn-primary">Terapkan</button>
                    </div>
                </div>
            </form>
        </div>

        <div class="grid-settings">
            <h5 class="mb-3 fw-bold text-center">Pengaturan Layout & Cetak</h5>
            <div class="grid-controls">
                <div>
                    <label class="form-label fw-bold">Layout Grid</label>
                    <select class="form-select" id="gridSelect">
                        <option value="auto">Auto (Sesuaikan Kertas)</option>
                        <option value="grid-2x3">2 × 3 (6 kartu) - Tulisan Besar</option>
                        <option value="grid-2x4">2 × 4 (8 kartu) - Tulisan Sedang</option>
                    </select>
                    <small class="text-muted">Grid yang lebih kecil menghasilkan tulisan yang lebih besar dan jelas</small>
                </div>
                <div>
                    <label class="form-label fw-bold">Ukuran Kertas</label>
                    <select class="form-select" id="paperSelect">
                        <option value="paper-a4" selected>A4 (210 × 297 mm)</option>
                        <option value="paper-a3">A3 (297 × 420 mm)</option>
                        <option value="paper-f4">F4 (215 × 330 mm)</option>
                    </select>
                    <small class="text-muted">Pastikan ukuran kertas sesuai dengan printer</small>
                </div>
            </div>
        </div>
        
        <div class="color-selector">
            <h6>Pilih Warna Kartu (25 Pilihan Gradient Gelap)</h6>
            <div class="mb-3">
                <small class="text-muted">
                    Pilih satu warna untuk semua kartu. Setiap santri akan mendapat 2 kartu dengan warna yang sama.
                </small>
            </div>
            <div class="color-options">
                <div class="color-option gradient-1 active" data-color="1" title="Navy Slate">
                    <div class="color-number-display">1</div>
                </div>
                <div class="color-option gradient-2" data-color="2" title="Ocean Deep">
                    <div class="color-number-display">2</div>
                </div>
                <div class="color-option gradient-3" data-color="3" title="Purple Dusk">
                    <div class="color-number-display">3</div>
                </div>
                <div class="color-option gradient-4" data-color="4" title="Forest Teal">
                    <div class="color-number-display">4</div>
                </div>
                <div class="color-option gradient-5" data-color="5" title="Dark Crimson">
                    <div class="color-number-display">5</div>
                </div>
                <div class="color-option gradient-6" data-color="6" title="Forest Green">
                    <div class="color-number-display">6</div>
                </div>
                <div class="color-option gradient-7" data-color="7" title="Chocolate Wood">
                    <div class="color-number-display">7</div>
                </div>
                <div class="color-option gradient-8" data-color="8" title="Midnight Forest">
                    <div class="color-number-display">8</div>
                </div>
                <div class="color-option gradient-9" data-color="9" title="Steel Gray">
                    <div class="color-number-display">9</div>
                </div>
                <div class="color-option gradient-10" data-color="10" title="Royal Purple">
                    <div class="color-number-display">10</div>
                </div>
                <div class="color-option gradient-11" data-color="11" title="Dark Navy">
                    <div class="color-number-display">11</div>
                </div>
                <div class="color-option gradient-12" data-color="12" title="Deep Violet">
                    <div class="color-number-display">12</div>
                </div>
                <div class="color-option gradient-13" data-color="13" title="Ocean Blue">
                    <div class="color-number-display">13</div>
                </div>
                <div class="color-option gradient-14" data-color="14" title="Mystic Purple">
                    <div class="color-number-display">14</div>
                </div>
                <div class="color-option gradient-15" data-color="15" title="Space Blue">
                    <div class="color-number-display">15</div>
                </div>
                <div class="color-option gradient-16" data-color="16" title="Galaxy Purple">
                    <div class="color-number-display">16</div>
                </div>
                <div class="color-option gradient-17" data-color="17" title="Deep Ocean">
                    <div class="color-number-display">17</div>
                </div>
                <div class="color-option gradient-18" data-color="18" title="Emerald Night">
                    <div class="color-number-display">18</div>
                </div>
                <div class="color-option gradient-19" data-color="19" title="Cosmic Purple">
                    <div class="color-number-display">19</div>
                </div>
                <div class="color-option gradient-20" data-color="20" title="Midnight Blue">
                    <div class="color-number-display">20</div>
                </div>
                <div class="color-option gradient-21" data-color="21" title="Arctic Blue">
                    <div class="color-number-display">21</div>
                </div>
                <div class="color-option gradient-22" data-color="22" title="Twilight Blue">
                    <div class="color-number-display">22</div>
                </div>
                <div class="color-option gradient-23" data-color="23" title="Carbon Gray">
                    <div class="color-number-display">23</div>
                </div>
                <div class="color-option gradient-24" data-color="24" title="Coffee Brown">
                    <div class="color-number-display">24</div>
                </div>
                <div class="color-option gradient-25" data-color="25" title="Teal Mystery">
                    <div class="color-number-display">25</div>
                </div>
            </div>
        </div>

        <div class="print-button-container">
            <button class="btn-print" onclick="window.print()">
                <i class="fas fa-print"></i> Cetak Semua Kartu (<span id="cardCount">{{ semua_pendaftar|length * 2 if semua_pendaftar else 0 }}</span> kartu)
            </button>
            <a href="{{ url_for('admin.dashboard') }}" class="btn-print btn-secondary-custom">
                ← Kembali ke Dashboard
            </a>
        </div>
        
        <div class="cards-wrapper color-1" id="cardsWrapper">
            {% for pendaftar in semua_pendaftar %}
                {# Cetak kartu pertama untuk santri #}
                <div class="card-barang">
                    <div class="card-content">
                        <h5>KARTU BARANG {{ 'PUTRA' if pendaftar.santri.jenis_kelamin == 'PUTRA' else 'PUTRI' }}</h5>
                        <div class="card-grid">
                            <div class="card-item">
                                <strong>👤 Nama Santri</strong>
                                <p>{{ pendaftar.santri.nama }}</p>
                            </div>
                            <div class="card-item">
                                <strong>📍 WA Wali</strong>
                                <p>{{ pendaftar.santri.no_hp_wali or '-' }}</p>
                            </div>
                            <div class="card-item">
                                <strong>👥 Rombongan</strong>
                                <p>{{ pendaftar.rombongan_pulang.nama_rombongan if pendaftar.rombongan_pulang else 'N/A' }}</p>
                            </div>
                            <div class="card-item">
                                <strong>📌 Titik Turun</strong>
                                <p>{{ pendaftar.titik_turun or '-' }}</p>
                            </div>
                            <div class="card-item" style="grid-column: span 2;">
                                <strong>🚌 Nama Bus</strong>
                                <p>{{ pendaftar.bus_pulang.nama_armada if pendaftar.bus_pulang else '-' }} - {{ pendaftar.bus_pulang.nomor_lambung or pendaftar.bus_pulang.plat_nomor or '-' }}</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-barang">
                    <div class="card-content">
                        <h5>KARTU BARANG {{ 'PUTRA' if pendaftar.santri.jenis_kelamin == 'PUTRA' else 'PUTRI' }}</h5>
                        <div class="card-grid">
                            <div class="card-item">
                                <strong>👤 Nama Santri</strong>
                                <p>{{ pendaftar.santri.nama }}</p>
                            </div>
                            <div class="card-item">
                                <strong>📍 WA Wali</strong>
                                <p>{{ pendaftar.santri.no_hp_wali or '-' }}</p>
                            </div>
                            <div class="card-item">
                                <strong>👥 Rombongan</strong>
                                <p>{{ pendaftar.rombongan_pulang.nama_rombongan if pendaftar.rombongan_pulang else 'N/A' }}</p>
                            </div>
                            <div class="card-item">
                                <strong>📌 Titik Turun</strong>
                                <p>{{ pendaftar.titik_turun or '-' }}</p>
                            </div>
                            <div class="card-item" style="grid-column: span 2;">
                                <strong>🚌 Nama Bus</strong>
                                <p>{{ pendaftar.bus_pulang.nama_armada if pendaftar.bus_pulang else '-' }} - {{ pendaftar.bus_pulang.nomor_lambung or pendaftar.bus_pulang.plat_nomor or '-' }}</p>
                            </div>
                             </div>
                    </div>
                </div>
            {% else %}
                <div class="alert alert-warning" style="grid-column: 1 / -1;">
                    <h5>⚠️ Tidak Ada Data</h5>
                    <p>Tidak ada data santri terdaftar di rombongan yang Anda kelola untuk dicetak.</p>
                </div>
            {% endfor %}
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const colorOptions = document.querySelectorAll('.color-option');
            const cardsWrapper = document.getElementById('cardsWrapper');
            const printContainer = document.getElementById('printContainer');
            const gridSelect = document.getElementById('gridSelect');
            const paperSelect = document.getElementById('paperSelect');
            let currentSelectedColor = '1';

            // Fungsi untuk update warna
            function updateColors() {
                cardsWrapper.className = 'cards-wrapper color-' + currentSelectedColor;
                
                // Tambahkan grid class yang sedang aktif
                const activeGrid = gridSelect.value;
                if (activeGrid === 'auto') {
                    cardsWrapper.classList.add('grid-auto');
                } else {
                    cardsWrapper.classList.add(activeGrid);
                }
                
                // Tambahkan paper class jika diperlukan untuk auto grid
                if (activeGrid === 'auto') {
                    const activePaper = paperSelect.value;
                    cardsWrapper.classList.add(activePaper);
                }
            }

            // Event listener untuk grid selection
            gridSelect.addEventListener('change', function() {
                updateColors();
                updateGridInfo();
            });

            // Fungsi untuk update info grid
            function updateGridInfo() {
                const gridInfo = {
                    'auto': { 'paper-a4': 15, 'paper-a3': 24, 'paper-f4': 15 },
                    'grid-2x3': 6,
                    'grid-2x4': 8
                };
                
                const selectedGrid = gridSelect.value;
                const selectedPaper = paperSelect.value;
                let maxCards;
                
                if (selectedGrid === 'auto') {
                    maxCards = gridInfo.auto[selectedPaper] || 15;
                } else {
                    maxCards = gridInfo[selectedGrid] || 15;
                }
                
                const cardCount = document.getElementById('cardCount');
                const printButton = document.querySelector('.btn-print');
                const currentCards = document.querySelectorAll('.card-barang').length;
                
                cardCount.textContent = Math.min(currentCards, maxCards);
                
                if (currentCards > maxCards) {
                    printButton.innerHTML = `<i class="fas fa-print"></i> Cetak ${maxCards} Kartu (${currentCards - maxCards} kartu akan terpotong)`;
                    printButton.style.background = 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)';
                } else {
                    printButton.innerHTML = `<i class="fas fa-print"></i> Cetak ${currentCards} Kartu`;
                    printButton.style.background = 'linear-gradient(135deg, #2c3e50 0%, #34495e 100%)';
                }
            }

            // Event listener untuk paper size selection
            paperSelect.addEventListener('change', function() {
                printContainer.className = printContainer.className.replace(/paper-\w+/g, '');
                printContainer.classList.add('print-container', this.value);
                updateColors();
                updateGridInfo();
            });

            // Event listener untuk color selection
            colorOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Hapus active dari semua opsi
                    colorOptions.forEach(opt => opt.classList.remove('active'));
                    
                    // Tambah active ke opsi yang dipilih
                    this.classList.add('active');
                    
                    currentSelectedColor = this.getAttribute('data-color');
                    updateColors();
                });
            });

            // Preview effects saat hover
            colorOptions.forEach(option => {
                option.addEventListener('mouseenter', function() {
                    if (!this.classList.contains('active')) {
                        const tempColor = this.getAttribute('data-color');
                        const originalClass = cardsWrapper.className;
                        
                        // Simpan class grid dan paper yang aktif
                        const gridClass = cardsWrapper.className.match(/grid-\w+/);
                        const paperClass = cardsWrapper.className.match(/paper-\w+/);
                        
                        cardsWrapper.className = 'cards-wrapper color-' + tempColor;
                        
                        // Restore grid dan paper classes
                        if (gridClass) cardsWrapper.classList.add(gridClass[0]);
                        if (paperClass) cardsWrapper.classList.add(paperClass[0]);
                        
                        const resetPreview = () => {
                            if (!this.matches(':hover')) {
                                cardsWrapper.className = originalClass;
                            }
                        };
                        
                        this.addEventListener('mouseleave', resetPreview, { once: true });
                    }
                });
            });

            // Inisialisasi tampilan
            updateColors();
            updateGridInfo();
            
            // Tambahkan smooth transitions
            cardsWrapper.style.transition = 'all 0.3s ease';
            
            // Update real-time counter saat DOM berubah
            const observer = new MutationObserver(function(mutations) {
                updateGridInfo();
            });
            
            observer.observe(cardsWrapper, { 
                childList: true, 
                subtree: true 
            });
        });

        // Fungsi untuk print dengan optimasi
        function optimizedPrint() {
            // Simpan state saat ini
            const currentTransition = cardsWrapper.style.transition;
            
            // Hilangkan transisi untuk print
            cardsWrapper.style.transition = 'none';
            
            // Print
            window.print();
            
            // Restore transisi setelah print
            setTimeout(() => {
                cardsWrapper.style.transition = currentTransition;
            }, 100);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl+P untuk print
            if (e.ctrlKey && e.key === 'p') {
                e.preventDefault();
                optimizedPrint();
            }
            
            // Number keys untuk quick color change (1-9, kemudian 0 untuk 10-25)
            if (e.key >= '1' && e.key <= '9') {
                const colorOption = document.querySelector(`.color-option[data-color="${e.key}"]`);
                if (colorOption) {
                    colorOption.click();
                }
            }
            
            // Shift + angka untuk warna 11-20 (Shift+1 = warna 11, dst)
            if (e.shiftKey && e.key >= '1' && e.key <= '9') {
                const colorNum = parseInt(e.key) + 10;
                if (colorNum <= 25) {
                    const colorOption = document.querySelector(`.color-option[data-color="${colorNum}"]`);
                    if (colorOption) {
                        colorOption.click();
                    }
                }
            }
            
            // Alt + angka untuk warna 21-25 (Alt+1 = warna 21, dst)
            if (e.altKey && e.key >= '1' && e.key <= '5') {
                const colorNum = parseInt(e.key) + 20;
                const colorOption = document.querySelector(`.color-option[data-color="${colorNum}"]`);
                if (colorOption) {
                    colorOption.click();
                }
            }
        });

        // Auto-save preferences ke localStorage (jika browser support)
        if (typeof(Storage) !== "undefined") {
            // Load saved preferences
            const savedColor = localStorage.getItem('cardColor');
            const savedGrid = localStorage.getItem('cardGrid');
            const savedPaper = localStorage.getItem('cardPaper');
            
            if (savedColor) {
                const colorOption = document.querySelector(`.color-option[data-color="${savedColor}"]`);
                if (colorOption) colorOption.click();
            }
            
            if (savedGrid) {
                const gridSelect = document.getElementById('gridSelect');
                gridSelect.value = savedGrid;
                gridSelect.dispatchEvent(new Event('change'));
            }
            
            if (savedPaper) {
                const paperSelect = document.getElementById('paperSelect');
                paperSelect.value = savedPaper;
                paperSelect.dispatchEvent(new Event('change'));
            }
            
            // Save preferences on change
            document.addEventListener('change', function(e) {
                if (e.target.id === 'gridSelect') {
                    localStorage.setItem('cardGrid', e.target.value);
                }
                if (e.target.id === 'paperSelect') {
                    localStorage.setItem('cardPaper', e.target.value);
                }
            });
            
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('color-option')) {
                    localStorage.setItem('cardColor', e.target.getAttribute('data-color'));
                }
            });
        }
    </script>

</body>
</html>