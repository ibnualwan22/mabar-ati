{% extends "_admin_layout.html" %}
{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h2">{{ title }}</h1>
</div>
<p class="text-muted">Dasbor pemantauan global untuk Korpus & Korwil. Semua data di halaman ini adalah rekapitulasi dari seluruh rombongan.</p>

<div class="card mb-4 shadow-sm">
    <div class="card-header bg-primary text-white">
        <h5><i class="fas fa-globe-asia me-2"></i>Statistik & Laporan Global</h5>
    </div>
    <div class="card-body">
        <div class="row align-items-center">
            <div class="col-md-6 border-end">
                <h6 class="text-center text-muted">PERJALANAN PULANG</h6>
                <div class="text-center my-3">
                    <div class="display-4 fw-bold text-primary">{{ global_stats.pulang }}</div>
                    <div class="fw-light">Peserta Ikut Pulang</div>
                </div>
                <div class="text-center text-danger small">
                    ({{ global_stats.tidak_pulang }} santri terdaftar tidak ikut pulang)
                </div>
                <div class="d-grid mt-3">
    <a href="https://wa.me/6281227225453?text={{ pesan_wa_pulang | urlencode }}" data-action="share/whatsapp/share" target="_blank" class="btn btn-success">
        <i class="fab fa-whatsapp me-2"></i>Lapor Jumlah Pulang
    </a>
</div>
            </div>
            <div class="col-md-6">
                <h6 class="text-center text-muted">PERJALANAN KEMBALI</h6>
                <div class="text-center my-3">
                    <div class="display-4 fw-bold text-info">{{ global_stats.kembali }}</div>
                    <div class="fw-light">Peserta Ikut Kembali</div>
                </div>
                <div class="text-center text-danger small">
                    ({{ global_stats.tidak_kembali }} santri terdaftar tidak ikut kembali)
                </div>
                <div class="d-grid mt-3">
    <a href="https://wa.me/6281227225453?text={{ pesan_wa_kembali | urlencode }}" data-action="share/whatsapp/share" target="_blank" class="btn btn-success">
        <i class="fab fa-whatsapp me-2"></i>Lapor Jumlah Kembali
    </a>
</div>
            </div>
        </div>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header">
        <h5><i class="fas fa-chart-bar me-2"></i>Ringkasan per Rombongan</h5>
    </div>
    <div class="table-responsive">
        <table class="table table-striped table-hover mb-0">
            <thead>
                <tr><th>Nama Rombongan</th><th class="text-center">Peserta Pulang</th><th class="text-center">Peserta Kembali</th></tr>
            </thead>
            <tbody>
                {% for data in rekap_rombongan %}
                <tr>
                    <td class="fw-bold">{{ data.nama }}</td>
                    <td class="text-center">{{ data.peserta_pulang }}</td>
                    <td class="text-center">{{ data.peserta_kembali }}</td>
                </tr>
                {% else %}
                <tr><td colspan="3" class="text-center text-muted py-4">Belum ada data rombongan.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header">
        <h5><i class="fas fa-user-times me-2"></i>Santri Terdaftar (Namun Memilih Tidak Ikut)</h5>
    </div>
    <div class="table-responsive">
        <table class="table table-striped table-hover mb-0">
            <thead>
                <tr><th>No.</th><th>Nama Santri</th><th>Rombongan</th><th>Status Perjalanan</th><th>Status Santri</th></tr>
            </thead>
            <tbody>
                {% for p in terdaftar_tidak_ikut %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ p.santri.nama }}</td>
                    <td>{{ p.rombongan_pulang.nama_rombongan if p.rombongan_pulang else 'N/A' }}</td>
                    <td>
                        {% if p.status_pulang == 'Tidak Ikut' %}<span class="badge bg-warning text-dark">Tidak Ikut Pulang</span>{% endif %}
                        {% if p.status_kembali == 'Tidak Ikut' %}<span class="badge bg-warning text-dark">Tidak Ikut Kembali</span>{% endif %}
                    </td>
                    <td><span class="badge bg-secondary">{{ p.santri.status_santri }}</span></td>
                </tr>
                {% else %}
                <tr><td colspan="5" class="text-center text-muted py-4">Tidak ada data.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h5><i class="fas fa-user-plus me-2"></i>Santri Belum Terdaftar (Status: Aktif, Partisipan, Wisuda)</h5>
    </div>
    <div class="table-responsive">
        <table class="table table-striped table-hover mb-0">
            <thead>
                <tr><th>No.</th><th>Nama Santri</th><th>Asal Wilayah</th><th>Status Santri</th></tr>
            </thead>
            <tbody>
                {% for s in belum_terdaftar %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ s.nama }}</td>
                    <td>{{ s.kabupaten }}</td>
                    <td><span class="badge bg-info text-dark">{{ s.status_santri }}</span></td>
                </tr>
                {% else %}
                <tr><td colspan="4" class="text-center text-muted py-4">Tidak ada santri yang belum terdaftar.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}