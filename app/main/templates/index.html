{% extends "main_layout.html" %}

{% block title %}Halaman Utama{% endblock %}

{% block content %}
    <header class="masthead" style="background-image: url('{{ url_for("static", filename="assets/img/header-bg.jpg") }}');">
        <div class="container">
            <div class="masthead-subheading">Selamat Datang di Platform Koordinasi Perpulangan</div>
            <div class="masthead-heading text-uppercase">Mabar Ati</div>
            {% if active_edisi and active_edisi.countdown_target_date %}
                <div id="countdown-title" class="masthead-subheading">{{ active_edisi.countdown_title }}</div>
                <div id="countdown" class="h1 text-warning mb-4"></div>
            {% endif %}
<a class="btn btn-primary btn-xl text-uppercase" href="{{ url_for('main.informasi_perpulangan') }}">Informasi Perpulangan</a>        </div>
    </header>
        <section class="page-section" id="services">
            <div class="container">
                <div class="text-center">
                    <h2 class="section-heading text-uppercase">Alur Pendaftaran</h2>
                    <h3 class="section-subheading text-muted">Ikuti langkah-langkah mudah berikut untuk mendaftar.</h3>
                </div>
                <div class="row text-center">
                    <div class="col-md-4">
                        <span class="fa-stack fa-4x">
                            <i class="fas fa-circle fa-stack-2x text-primary"></i>
                            <i class="fas fa-search fa-stack-1x fa-inverse"></i>
                        </span>
                        <h4 class="my-3">1. Cari Rombongan</h4>
                        <p class="text-muted">Gulir ke bawah ke bagian "Daftar Rombongan" dan temukan rombongan yang sesuai dengan daerah tujuan Anda.</p>
                    </div>
                    <div class="col-md-4">
                        <span class="fa-stack fa-4x">
                            <i class="fas fa-circle fa-stack-2x text-primary"></i>
                            <i class="fab fa-whatsapp fa-stack-1x fa-inverse"></i>
                        </span>
                        <h4 class="my-3">2. Hubungi Penanggung Jawab</h4>
                        <p class="text-muted">Klik pada rombongan untuk melihat detail. Hubungi nomor Penanggung Jawab (PJ) yang tertera untuk konfirmasi.</p>
                    </div>
                    <div class="col-md-4">
                        <span class="fa-stack fa-4x">
                            <i class="fas fa-circle fa-stack-2x text-primary"></i>
                            <i class="fas fa-money-check-alt fa-stack-1x fa-inverse"></i>
                        </span>
                        <h4 class="my-3">3. Lakukan Pembayaran</h4>
                        <p class="text-muted">Selesaikan pendaftaran dengan melakukan pembayaran ke nomor rekening yang tertera pada detail rombongan.</p>
                    </div>
                </div>
            </div>
        </section>
        
        <section class="page-section bg-light" id="portfolio">
    <div class="container">
        <div class="text-center">
            <h2 class="section-heading text-uppercase">Daftar Rombongan</h2>
            {% if active_edisi %}
                <h3 class="section-subheading text-muted">Edisi {{ active_edisi.nama }}</h3>
            {% else %}
                <h3 class="section-subheading text-muted">Saat ini belum ada edisi perpulangan yang aktif.</h3>
            {% endif %}
        </div>
        <div class="row">
            {% for rombongan in semua_rombongan %}
            <div class="col-lg-4 col-sm-6 mb-4">
                <div class="portfolio-item h-100">
                    <a class="portfolio-link" data-bs-toggle="modal" href="#portfolioModal{{ rombongan.id }}">
                        <div class="portfolio-hover">
                            <div class="portfolio-hover-content"><i class="fas fa-plus fa-3x"></i></div>
                        </div>
                        <img class="img-fluid" src="{{ url_for('static', filename='assets/img/portfolio/4.jpg') }}" alt="Gambar Rombongan" />
                    </a>
                    <div class="portfolio-caption">
                        <div class="portfolio-caption-heading">{{ rombongan.nama_rombongan }}</div>
                        <div class="portfolio-caption-subheading text-muted">{{ rombongan.cakupan_wilayah|map(attribute='label')|join(', ') }}</div>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="col-12 text-center">
                <p>Belum ada rombongan yang dibuat untuk edisi ini.</p>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

{% if semua_rombongan %}
{% for rombongan in semua_rombongan %}
    <div class="portfolio-modal modal fade" id="portfolioModal{{ rombongan.id }}" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content border-0 shadow-lg">
                <div class="container-fluid">
                    <div class="row justify-content-center">
                        <div class="col-lg-12">
                            <div class="modal-body p-0">
                                <!-- Header Section -->
                                <div class="bg-gradient-primary text-white p-4 rounded-top position-relative overflow-hidden">
                                    <div class="position-absolute top-0 end-0 opacity-25">
                                        <i class="fas fa-bus fa-6x"></i>
                                    </div>
                                    <button type="button" class="btn-close btn-close-white position-absolute top-0 end-0 m-3" data-bs-dismiss="modal" aria-label="Close"></button>
                                    <div class="position-relative">
                                        <h2 class="text-white mb-2 fw-bold">{{ rombongan.nama_rombongan }}</h2>
                                        <p class="mb-0 opacity-75"><i class="fas fa-calendar-check me-2"></i>Edisi {{ active_edisi.nama }}</p>
                                    </div>
                                </div>

                                <!-- Content Section -->
                                <div class="p-4">
                                    <!-- Penanggung Jawab & Jadwal -->
                                    <div class="row g-4 mb-4">
                                        <div class="col-md-6">
                                            <div class="card border-0 bg-light h-100">
                                                <div class="card-header bg-white border-0 pb-0">
                                                    <h5 class="card-title text-secondary mb-0">
                                                        <i class="fas fa-users me-2"></i>Penanggung Jawab
                                                    </h5>
                                                </div>
                                                <div class="card-body pt-3">
                                                    <div class="row g-3">
                                                        <div class="col-12">
                                                            <div class="d-flex align-items-center justify-content-between p-3 bg-white rounded shadow-sm">
                                                                <div>
                                                                    <small class="text-muted d-block">PJ Putra</small>
                                                                    <strong class="text-dark">{{ rombongan.penanggung_jawab_putra or '-' }}</strong>
                                                                </div>
                                                                {% if rombongan.kontak_person_putra %}
                                                                <a href="https://wa.me/{{ rombongan.kontak_person_putra }}" target="_blank" class="btn btn-success btn-sm rounded-pill">
                                                                    <i class="fab fa-whatsapp me-1"></i> Hubungi
                                                                </a>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                        <div class="col-12">
                                                            <div class="d-flex align-items-center justify-content-between p-3 bg-white rounded shadow-sm">
                                                                <div>
                                                                    <small class="text-muted d-block">PJ Putri</small>
                                                                    <strong class="text-dark">{{ rombongan.penanggung_jawab_putri or '-' }}</strong>
                                                                </div>
                                                                {% if rombongan.kontak_person_putri %}
                                                                <a href="https://wa.me/{{ rombongan.kontak_person_putri }}" target="_blank" class="btn btn-success btn-sm rounded-pill">
                                                                    <i class="fab fa-whatsapp me-1"></i> Hubungi
                                                                </a>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6">
                                            <div class="card border-0 bg-light h-100">
                                                <div class="card-header bg-white border-0 pb-0">
                                                    <h5 class="card-title text-secondary mb-0">
                                                        <i class="fas fa-calendar-alt me-2"></i>Jadwal
                                                    </h5>
                                                </div>
                                                <div class="card-body pt-3">
                                                    <div class="row g-3">
                                                        <div class="col-12">
                                                            <div class="p-3 bg-white rounded shadow-sm">
                                                                <div class="d-flex align-items-center">
                                                                    <div class="bg-light border rounded-circle p-2 me-3">
                                                                        <i class="fas fa-arrow-up text-muted"></i>
                                                                    </div>
                                                                    <div>
                                                                        <small class="text-muted d-block">Pulang</small>
                                                                        <strong class="text-dark">{{ rombongan.jadwal_pulang|datetime_wib if rombongan.jadwal_pulang else 'N/A' }}</strong>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-12">
                                                            <div class="p-3 bg-white rounded shadow-sm">
                                                                <div class="d-flex align-items-center">
                                                                    <div class="bg-light border rounded-circle p-2 me-3">
                                                                        <i class="fas fa-arrow-down text-muted"></i>
                                                                    </div>
                                                                    <div>
                                                                        <small class="text-muted d-block">Kembali</small>
                                                                        <strong class="text-dark">{{ rombongan.jadwal_berangkat|datetime_wib if rombongan.jadwal_berangkat else 'N/A' }}</strong>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Cakupan Wilayah & Informasi Pembayaran -->
                                    <div class="row g-4 mb-4">
                                        <div class="col-md-6">
                                            <div class="card border-0 shadow-sm">
                                                <div class="card-header bg-light text-dark border-0">
                                                    <h6 class="mb-0"><i class="fas fa-map-marked-alt me-2"></i>Cakupan Wilayah</h6>
                                                </div>
                                                <div class="card-body">
                                                    <p class="mb-0 text-muted">
                                                        {% if rombongan.cakupan_wilayah %}
                                                            <i class="fas fa-map-pin text-secondary me-2"></i>{{ rombongan.cakupan_wilayah|map(attribute='label')|join(', ') }}
                                                        {% else %}
                                                            <i class="fas fa-info-circle text-muted me-2"></i>Informasi cakupan wilayah belum tersedia.
                                                        {% endif %}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6">
                                            <div class="card border-0 shadow-sm">
                                                <div class="card-header bg-light text-dark border-0">
                                                    <h6 class="mb-0"><i class="fas fa-credit-card me-2"></i>Informasi Pembayaran</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="d-flex align-items-center justify-content-between">
                                                        <div>
                                                            <small class="text-muted d-block">No. Rekening</small>
                                                            <strong class="text-dark">{{ rombongan.nomor_rekening or 'Belum tersedia' }}</strong>
                                                        </div>
                                                        {% if rombongan.nomor_rekening %}
                                                        <button class="btn btn-outline-secondary btn-sm rounded-pill" onclick="copyToClipboard('{{ rombongan.nomor_rekening }}', this)">
                                                            <i class="fas fa-copy me-1"></i> Salin
                                                        </button>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Daftar Bus & Pelacakan -->
                                    <div class="card border-0 shadow-sm mb-4">
                                        <div class="card-header bg-light text-dark border-0">
                                            <h5 class="mb-0"><i class="fas fa-bus-alt me-2"></i>Daftar Bus & Pelacakan</h5>
                                        </div>
                                        <div class="card-body p-0">
                                            {% for bus in rombongan.buses %}
                                            <div class="d-flex align-items-center justify-content-between p-3 border-bottom">
                                                <div class="d-flex align-items-center">
                                                    <div class="bg-light border rounded-circle p-2 me-3">
                                                        <i class="fas fa-bus text-muted"></i>
                                                    </div>
                                                    <div>
                                                        <strong class="text-dark d-block">{{ bus.nama_armada }}</strong>
                                                        <small class="text-muted">{{ bus.nomor_lambung or bus.plat_nomor }}</small>
                                                    </div>
                                                </div>
                                                {% if bus.gmaps_share_url %}
                                                    <a href="{{ bus.gmaps_share_url }}" target="_blank" class="btn btn-outline-dark btn-sm rounded-pill">
                                                        <i class="fas fa-map-marker-alt me-1"></i> Lacak Lokasi
                                                    </a>
                                                {% else %}
                                                    <span class="badge bg-light text-dark border rounded-pill">Pelacakan Belum Aktif</span>
                                                {% endif %}
                                            </div>
                                            {% else %}
                                            <div class="p-4 text-center text-muted">
                                                <i class="fas fa-info-circle fa-2x mb-2 d-block"></i>
                                                Informasi bus belum tersedia.
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </div>

                                    <!-- Detail Harga -->
                                    <div class="card border-0 shadow-sm">
                                        <div class="card-header bg-light text-dark border-0">
                                            <h5 class="mb-0"><i class="fas fa-money-bill-wave me-2"></i>Detail Harga per Titik Turun/Jemput</h5>
                                        </div>
                                        <div class="card-body p-0">
                                            <div class="table-responsive">
                                                <table class="table table-hover mb-0">
                                                    <thead class="bg-secondary text-white">
                                                        <tr>
                                                            <th class="border-0 py-3"><i class="fas fa-map-pin me-2"></i>Titik Turun/Jemput</th>
                                                            <th class="border-0 py-3"><i class="fas fa-money-bill-wave me-2"></i>Biaya per Perjalanan</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for tarif in rombongan.tarifs %}
                                                        <tr>
                                                            <td class="py-3">
                                                                <div class="d-flex align-items-center">
                                                                    <div class="bg-light border rounded-circle p-1 me-2" style="width: 8px; height: 8px;"></div>
                                                                    {{ tarif.titik_turun }}
                                                                </div>
                                                            </td>
                                                            <td class="py-3">
                                                                <span class="badge bg-dark fs-6 px-3 py-2">
                                                                    Rp {{ "{:,.0f}".format((tarif.harga_bus|default(0)) + (tarif.fee_korda|default(0)) + 10000).replace(',', '.') }}
                                                                </span>
                                                            </td>
                                                        </tr>
                                                        {% else %}
                                                        <tr>
                                                            <td colspan="2" class="text-center py-4 text-muted">
                                                                <i class="fas fa-info-circle fa-2x mb-2 d-block"></i>
                                                                Informasi tarif belum tersedia.
                                                            </td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Close Button -->
                                    <div class="text-center mt-4 pt-3 border-top">
                                        <button class="btn btn-danger btn-lg rounded-pill px-5" data-bs-dismiss="modal" type="button">
                                            <i class="fas fa-times me-2"></i> Tutup
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
{% endif %}

        <section class="page-section" id="about">
            <div class="container">
                <div class="text-center">
                    <h2 class="section-heading text-uppercase">Lini Masa</h2>
                    <h3 class="section-subheading text-muted">Perjalanan Mabar Ati dalam melayani koordinasi perpulangan.</h3>
                </div>
                <ul class="timeline">
                    <li>
                        <div class="timeline-image"><img class="rounded-circle img-fluid" src="{{ url_for('static', filename='assets/img/about/1.jpg') }}" alt="..." /></div>
                        <div class="timeline-panel">
                            <div class="timeline-heading">
                                <h4>2022</h4>
                                <h4 class="subheading">Awal Mula Koordinasi</h4>
                            </div>
                            <div class="timeline-body"><p class="text-muted">Berawal dari kebutuhan untuk mengorganisir kepulangan bersama, sistem koordinasi pertama kali dibentuk secara manual melalui grup chat.</p></div>
                        </div>
                    </li>
                    <li class="timeline-inverted">
                        <div class="timeline-image"><img class="rounded-circle img-fluid" src="{{ url_for('static', filename='assets/img/about/2.jpg') }}" alt="..." /></div>
                        <div class="timeline-panel">
                            <div class="timeline-heading">
                                <h4>2023</h4>
                                <h4 class="subheading">Pembentukan Tim & Rute</h4>
                            </div>
                            <div class="timeline-body"><p class="text-muted">Tim inti terbentuk dan mulai memetakan rute-rute utama serta menunjuk Penanggung Jawab (PJ) untuk setiap daerah.</p></div>
                        </div>
                    </li>
                    <li>
                        <div class="timeline-image"><img class="rounded-circle img-fluid" src="{{ url_for('static', filename='assets/img/about/3.jpg') }}" alt="..." /></div>
                        <div class="timeline-panel">
                            <div class="timeline-heading">
                                <h4>2024</h4>
                                <h4 class="subheading">Digitalisasi Sistem</h4>
                            </div>
                            <div class="timeline-body"><p class="text-muted">Platform digital Mabar-Ati diluncurkan untuk mempermudah pendaftaran, pembayaran, dan penyebaran informasi.</p></div>
                        </div>
                    </li>
                    <li class="timeline-inverted">
                        <div class="timeline-image"><img class="rounded-circle img-fluid" src="{{ url_for('static', filename='assets/img/about/4.jpg') }}" alt="..." /></div>
                        <div class="timeline-panel">
                            <div class="timeline-heading">
                                <h4>2025 - Sekarang</h4>
                                <h4 class="subheading">Ekspansi & Peningkatan</h4>
                            </div>
                            <div class="timeline-body"><p class="text-muted">Terus melakukan ekspansi rute dan menyempurnakan fitur platform untuk memberikan layanan yang lebih baik dan komprehensif.</p></div>
                        </div>
                    </li>
                    <li class="timeline-inverted">
                        <div class="timeline-image">
                            <h4>Mari<br />Bergabung<br />Bersama!</h4>
                        </div>
                    </li>
                </ul>
            </div>
        </section>

        <section class="page-section bg-light" id="team">
            <div class="container">
                <div class="text-center">
                    <h2 class="section-heading text-uppercase">Contact Person</h2>
                    <h3 class="section-subheading text-muted">Nomor-nomor penting Seputar Perpulangan</h3>
                </div>
                <div class="row justify-content-center">
    <div class="col-lg-4">
        <div class="team-member">
            <img class="mx-auto rounded-circle" src="{{ url_for('static', filename='assets/img/team/1.jpg') }}" alt="..." />
            <h4>Keamanan Putra</h4>
            <p class="text-muted">
                <a href="https://wa.me/62895325578379" target="_blank">+62 895-3255-78379</a>
            </p>
        </div>
    </div>


                    <div class="col-lg-4">
                        <div class="team-member">
                            <img class="mx-auto rounded-circle" src="{{ url_for('static', filename='assets/img/team/2.jpg') }}" alt="..." />
                            <h4>Keamanan Putri</h4>
                            <p class="text-muted">
                <a href="https://wa.me/6285742572990" target="_blank">+62 857-4257-2990</a>
            </p>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <div class="team-member">
                            <img class="mx-auto rounded-circle" src="{{ url_for('static', filename='assets/img/team/2.jpg') }}" alt="..." />
                            <h4>Keamanan Putri</h4>
                            <p class="text-muted">
                <a href="https://wa.me/6285742572990" target="_blank">+62 857-4257-2990</a>
            </p>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <div class="team-member">
                            <img class="mx-auto rounded-circle" src="{{ url_for('static', filename='assets/img/team/2.jpg') }}" alt="..." />
                            <h4>Keamanan Putri</h4>
                            <p class="text-muted">
                <a href="https://wa.me/6285742572990" target="_blank">+62 857-4257-2990</a>
            </p>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <div class="team-member">
                            <img class="mx-auto rounded-circle" src="{{ url_for('static', filename='assets/img/team/2.jpg') }}" alt="..." />
                            <h4>Keamanan Putri</h4>
                            <p class="text-muted">
                <a href="https://wa.me/6285742572990" target="_blank">+62 857-4257-2990</a>
            </p>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <div class="team-member">
                            <img class="mx-auto rounded-circle" src="{{ url_for('static', filename='assets/img/team/2.jpg') }}" alt="..." />
                            <h4>Keamanan Putri</h4>
                            <p class="text-muted">
                <a href="https://wa.me/6285742572990" target="_blank">+62 857-4257-2990</a>
            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
   <script>
    // --- LOGIKA UNTUK COUNTDOWN TIMER ---
    const countdownElement = document.getElementById('countdown');
    // Ambil tanggal target dari data yang dikirim Flask/Jinja2
    const targetDate = new Date("{{ active_edisi.countdown_target_date.isoformat() if active_edisi and active_edisi.countdown_target_date else '' }}").getTime();

    if (countdownElement && targetDate) {
        const interval = setInterval(function() {
            const now = new Date().getTime();
            const distance = targetDate - now;

            // Kalkulasi waktu
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            // Tampilkan hasilnya
            countdownElement.innerHTML = days + "Hari " + hours + "j " + minutes + "m " + seconds + "d Lagi";

            // Jika hitung mundur selesai
            if (distance < 0) {
                clearInterval(interval);
                countdownElement.innerHTML = "WAKTU TELAH TIBA";
            }
        }, 1000);
    }
    function copyToClipboard(text, buttonElement) {
    navigator.clipboard.writeText(text).then(function() {
        // Beri tahu user bahwa teks sudah disalin
        const originalText = buttonElement.innerHTML;
        buttonElement.innerHTML = '<i class="fas fa-check me-1"></i> Tersalin!';
        setTimeout(function() {
            buttonElement.innerHTML = originalText;
        }, 2000); // Kembalikan ke teks semula setelah 2 detik
    }, function(err) {
        alert('Gagal menyalin nomor rekening.');
    });
}
</script>

{% endblock %}
